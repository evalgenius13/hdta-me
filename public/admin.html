<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HDTA Admin Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: #f8fafc; 
            color: #1f2937; 
            line-height: 1.5;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 24px; font-weight: 700; }
        .status-badge { 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 14px; 
            font-weight: 600;
        }
        .status-live { background: #dcfce7; color: #166534; }
        .status-draft { background: #fef3c7; color: #92400e; }

        .actions { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .btn { 
            background: #3b82f6; 
            color: white; 
            padding: 10px 16px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn:hover { background: #2563eb; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-danger { background: #dc2626; }
        .btn-danger:hover { background: #b91c1c; }

        .tabs { 
            display: flex; 
            gap: 4px; 
            margin-bottom: 20px;
        }
        .tab { 
            padding: 12px 20px; 
            background: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            transition: all 0.2s;
        }
        .tab.active { background: #3b82f6; color: white; }
        .tab:not(.active):hover { background: #f1f5f9; }

        .panel { 
            background: white; 
            border-radius: 0 8px 8px 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            padding: 20px;
            display: none;
        }
        .panel.active { display: block; }

        .article-grid { display: grid; gap: 16px; }
        .article-card { 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            overflow: hidden;
            transition: box-shadow 0.2s;
        }
        .article-card:hover { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        .article-header { 
            padding: 16px; 
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }
        .article-title { 
            font-weight: 600; 
            font-size: 16px; 
            line-height: 1.4;
            flex: 1;
        }
        .article-meta { 
            font-size: 12px; 
            color: #6b7280; 
            margin-top: 4px;
        }
        .article-score { 
            background: #f3f4f6; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            font-weight: 600;
            white-space: nowrap;
        }

        .article-content { padding: 16px; }
        .article-description { 
            color: #4b5563; 
            font-size: 14px; 
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .analysis-section { margin-top: 12px; }
        .analysis-label { 
            font-size: 12px; 
            font-weight: 600; 
            text-transform: uppercase; 
            color: #374151; 
            margin-bottom: 6px;
        }
        .analysis-content { 
            background: #f9fafb; 
            padding: 12px; 
            border-radius: 6px; 
            font-size: 14px; 
            line-height: 1.6;
        }
        .analysis-status { 
            display: inline-flex; 
            align-items: center; 
            gap: 6px; 
            font-size: 12px; 
            margin-bottom: 8px;
        }
        .status-dot { 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
        }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }

        .article-actions { 
            padding: 12px 16px; 
            background: #f9fafb; 
            border-top: 1px solid #f3f4f6;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .btn-small { 
            padding: 6px 12px; 
            font-size: 12px; 
        }

        .settings-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px;
        }
        .setting-group { 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 16px;
        }
        .setting-group h3 { 
            font-size: 16px; 
            font-weight: 600; 
            margin-bottom: 12px;
        }
        .setting-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 12px;
        }
        .setting-item:last-child { margin-bottom: 0; }
        .setting-input { 
            padding: 6px 10px; 
            border: 1px solid #d1d5db; 
            border-radius: 4px; 
            width: 100px;
        }

        .logs { 
            background: #1f2937; 
            color: #f9fafb; 
            padding: 16px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 13px; 
            height: 400px; 
            overflow-y: auto;
        }
        .log-line { margin-bottom: 4px; }
        .log-error { color: #fca5a5; }
        .log-success { color: #86efac; }
        .log-warning { color: #fcd34d; }

        .loading { 
            text-align: center; 
            padding: 40px; 
            color: #6b7280;
        }
        .spinner { 
            width: 20px; 
            height: 20px; 
            border: 2px solid #e5e7eb; 
            border-top: 2px solid #3b82f6; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            display: inline-block; 
            margin-right: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1000;
        }
        .modal-content { 
            background: white; 
            margin: 50px auto; 
            padding: 20px; 
            border-radius: 8px; 
            max-width: 600px; 
            max-height: 80vh; 
            overflow-y: auto;
        }
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
        }
        .modal-title { font-size: 18px; font-weight: 600; }
        .close-btn { 
            background: none; 
            border: none; 
            font-size: 24px; 
            cursor: pointer; 
            color: #6b7280;
        }
        .close-btn:hover { color: #374151; }

        textarea { 
            width: 100%; 
            min-height: 200px; 
            padding: 12px; 
            border: 1px solid #d1d5db; 
            border-radius: 6px; 
            font-family: inherit; 
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>HDTA Admin Panel</h1>
                <div class="status-badge status-live" id="system-status">System Live</div>
            </div>
            <div id="edition-info">Loading...</div>
        </div>

        <div class="actions">
            <button class="btn" onclick="triggerUpdate()">üöÄ Force Update Today</button>
            <button class="btn btn-secondary" onclick="refreshData()">üîÑ Refresh Data</button>
            <button class="btn btn-secondary" onclick="testPrompt()">üß™ Test Prompt</button>
            <button class="btn btn-danger" onclick="clearToday()">üóëÔ∏è Clear Today's Edition</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('articles')">üì∞ Articles</button>
            <button class="tab" onclick="showTab('prompts')">üéØ Prompts</button>
            <button class="tab" onclick="showTab('add-article')">‚ûï Add Article</button>
            <button class="tab" onclick="showTab('preview')">üëÅÔ∏è Preview</button>
            <button class="tab" onclick="showTab('bulk')">‚ö° Bulk Actions</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
            <button class="tab" onclick="showTab('logs')">üìã Logs</button>
            <button class="tab" onclick="showTab('analytics')">üìä Analytics</button>
        </div>

        <div id="articles-panel" class="panel active">
            <div class="article-filter-tabs" style="margin-bottom: 16px;">
                <button class="btn btn-small" id="filter-all" onclick="filterArticles('all')">All Articles</button>
                <button class="btn btn-small btn-secondary" id="filter-published" onclick="filterArticles('published')">Published (6)</button>
                <button class="btn btn-small btn-secondary" id="filter-drafts" onclick="filterArticles('drafts')">Drafts</button>
                <button class="btn btn-small btn-secondary" id="filter-queue" onclick="filterArticles('queue')">Queue</button>
                <button class="btn btn-small btn-secondary" id="filter-rejected" onclick="filterArticles('rejected')">Rejected</button>
            </div>
            
            <div class="loading" id="articles-loading">
                <span class="spinner"></span>
                Loading articles...
            </div>
            <div class="article-grid" id="articles-grid" style="display: none;"></div>
        </div>

        <div id="prompts-panel" class="panel">
            <h3>AI Prompt Management</h3>
            <div style="margin-bottom: 20px;">
                <label for="prompt-select" style="display: block; margin-bottom: 8px; font-weight: 600;">Select Prompt Template:</label>
                <select id="prompt-select" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; margin-right: 12px;">
                    <option value="current">Current Prompt</option>
                    <option value="insider">Insider Voice</option>
                    <option value="consumer">Consumer Focus</option>
                    <option value="technical">Technical Detail</option>
                    <option value="custom">Custom Template</option>
                </select>
                <button class="btn btn-small" onclick="loadPromptTemplate()">Load Template</button>
                <button class="btn btn-small btn-secondary" onclick="savePromptTemplate()">Save as Template</button>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label for="prompt-editor" style="display: block; margin-bottom: 8px; font-weight: 600;">System Prompt:</label>
                <textarea id="prompt-editor" style="height: 120px;" placeholder="Enter the system prompt that defines the AI's role and tone...">You are a seasoned policy insider who explains complex regulations in terms of real human impact. Be specific, credible, and revealing about how policy actually works in practice. Avoid euphemisms and jargon while maintaining credibility.</textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label for="user-prompt-editor" style="display: block; margin-bottom: 8px; font-weight: 600;">User Prompt Template:</label>
                <textarea id="user-prompt-editor" style="height: 200px;" placeholder="Enter the user prompt template with placeholders like {title}, {description}...">Write 130 to 170 words as a compelling insider analysis that reveals what's really happening. Plain English but deep policy knowledge.

1) IMMEDIATE IMPACT: Lead with the concrete consequence people will feel. Be specific - "Your student loan payment drops $150/month" not "payments may change." Think like someone who's seen this before.

2) THE REAL MECHANICS: How does this actually work? Include specific timelines, dollar amounts, eligibility details. What's the implementation reality vs. the press release spin?

3) WINNERS & LOSERS: Who actually benefits and who gets hurt? Be direct about specific industries, regions, or groups when the evidence supports it.

4) INSIDER PERSPECTIVE: What's not being emphasized publicly? Historical context? Hidden timelines? Watch for details that signal the true long-term impact.

Policy: "{title}"
Details: "{description}"
Source: "{source}"
Date: "{date}"</textarea>
            </div>
            
            <div>
                <button class="btn" onclick="testPrompt()">üß™ Test Prompt</button>
                <button class="btn btn-secondary" onclick="savePrompts()">üíæ Save Prompts</button>
                <button class="btn btn-secondary" onclick="resetPrompts()">üîÑ Reset to Default</button>
            </div>
            
            <div id="prompt-test-result" style="margin-top: 20px; display: none;">
                <h4>Test Result:</h4>
                <div style="background: #f9fafb; padding: 12px; border-radius: 6px; border: 1px solid #e5e7eb;"></div>
            </div>
        </div>

        <div id="add-article-panel" class="panel">
            <h3>Add Article Manually</h3>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Article URL:</label>
                <div style="display: flex; gap: 12px;">
                    <input type="url" id="article-url" placeholder="https://example.com/article" style="flex: 1; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <button class="btn" onclick="extractArticle()">üìÑ Extract</button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Title:</label>
                <input type="text" id="manual-title" placeholder="Article headline" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Description:</label>
                <textarea id="manual-description" placeholder="Article summary or first paragraph" style="height: 100px; width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Source:</label>
                <input type="text" id="manual-source" placeholder="Publication name" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Status:</label>
                <select id="manual-status" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <option value="queue">Queue (analyze later)</option>
                    <option value="draft">Draft (analyze now)</option>
                    <option value="published">Published (add to main site)</option>
                </select>
            </div>
            
            <div>
                <button class="btn" onclick="addManualArticle()">‚ûï Add Article</button>
                <button class="btn btn-secondary" onclick="clearManualForm()">üóëÔ∏è Clear Form</button>
            </div>
        </div>

        <div id="preview-panel" class="panel">
            <h3>Live Preview</h3>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-small" onclick="togglePreviewMode('desktop')">üñ•Ô∏è Desktop</button>
                <button class="btn btn-small btn-secondary" onclick="togglePreviewMode('mobile')">üì± Mobile</button>
                <button class="btn btn-small btn-secondary" onclick="refreshPreview()">üîÑ Refresh</button>
            </div>
            
            <div id="preview-container" style="border: 1px solid #e5e7eb; border-radius: 8px; background: white; min-height: 400px;">
                <iframe id="preview-frame" src="" style="width: 100%; height: 600px; border: none; border-radius: 8px;"></iframe>
            </div>
        </div>

        <div id="bulk-panel" class="panel">
            <h3>Bulk Operations</h3>
            <div class="settings-grid">
                <div class="setting-group">
                    <h4>Regenerate Analysis</h4>
                    <div style="margin-bottom: 12px;">
                        <button class="btn" onclick="bulkRegenerateAll()">üîÑ Regenerate All Published</button>
                        <button class="btn btn-secondary" onclick="bulkRegenerateDrafts()">üîÑ Regenerate Drafts</button>
                        <button class="btn btn-secondary" onclick="bulkAnalyzeQueue()">‚ö° Analyze Queue</button>
                    </div>
                    <p style="font-size: 14px; color: #6b7280;">Re-run AI analysis on existing articles with current prompts.</p>
                </div>
                
                <div class="setting-group">
                    <h4>Content Operations</h4>
                    <div style="margin-bottom: 12px;">
                        <input type="text" id="find-text" placeholder="Find text..." style="margin-right: 8px; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                        <input type="text" id="replace-text" placeholder="Replace with..." style="margin-right: 8px; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                        <button class="btn btn-small" onclick="bulkFindReplace()">üîç Find & Replace</button>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <button class="btn btn-secondary" onclick="bulkPromoteQueue()">‚¨ÜÔ∏è Promote Best Queue to Published</button>
                        <button class="btn btn-secondary" onclick="bulkDemoteWorst()">‚¨áÔ∏è Demote Worst Published to Drafts</button>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h4>Cleanup Operations</h4>
                    <div style="margin-bottom: 12px;">
                        <button class="btn btn-danger" onclick="bulkDeleteRejected()">üóëÔ∏è Delete All Rejected</button>
                        <button class="btn btn-danger" onclick="bulkDeleteOld()">üóëÔ∏è Delete Articles > 7 Days</button>
                        <button class="btn btn-danger" onclick="resetToday()">üîÑ Reset Today's Edition</button>
                    </div>
                    <p style="font-size: 14px; color: #6b7280;">‚ö†Ô∏è These operations cannot be undone.</p>
                </div>
            </div>
            
            <div id="bulk-progress" style="margin-top: 20px; display: none;">
                <div style="background: #f3f4f6; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div id="bulk-progress-bar" style="background: #3b82f6; height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <p id="bulk-status" style="margin-top: 8px; font-size: 14px; color: #6b7280;">Processing...</p>
            </div>
        </div>

        <div id="settings-panel" class="panel">
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>Article Selection</h3>
                    <div class="setting-item">
                        <label>Max Articles:</label>
                        <input type="number" class="setting-input" id="max-articles" value="6" min="3" max="10">
                    </div>
                    <div class="setting-item">
                        <label>Days Back:</label>
                        <input type="number" class="setting-input" id="days-back" value="3" min="1" max="7">
                    </div>
                    <div class="setting-item">
                        <label>Min Score:</label>
                        <input type="number" class="setting-input" id="min-score" value="10" min="0" max="50">
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>Analysis</h3>
                    <div class="setting-item">
                        <label>Word Count Min:</label>
                        <input type="number" class="setting-input" id="word-min" value="100" min="50" max="150">
                    </div>
                    <div class="setting-item">
                        <label>Word Count Max:</label>
                        <input type="number" class="setting-input" id="word-max" value="250" min="200" max="300">
                    </div>
                    <div class="setting-item">
                        <label>AI Temperature:</label>
                        <input type="number" class="setting-input" id="temperature" value="0.4" min="0" max="1" step="0.1">
                    </div>
                </div>

                <div class="setting-group">
                    <h3>Filtering</h3>
                    <div class="setting-item">
                        <label>Similarity Threshold:</label>
                        <input type="number" class="setting-input" id="similarity" value="0.75" min="0.5" max="0.9" step="0.05">
                    </div>
                    <div class="setting-item">
                        <label>Auto-publish:</label>
                        <input type="checkbox" id="auto-publish" checked>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button class="btn" onclick="saveSettings()">üíæ Save Settings</button>
                <button class="btn btn-secondary" onclick="resetSettings()">üîÑ Reset to Defaults</button>
            </div>
        </div>

        <div id="logs-panel" class="panel">
            <div style="margin-bottom: 12px;">
                <button class="btn btn-secondary btn-small" onclick="refreshLogs()">üîÑ Refresh</button>
                <button class="btn btn-secondary btn-small" onclick="clearLogs()">üóëÔ∏è Clear</button>
            </div>
            <div class="logs" id="logs-container">
                <div class="log-line log-success">[12:34:56] System initialized</div>
                <div class="log-line">[12:35:01] Fetching articles from GNews API...</div>
                <div class="log-line log-warning">[12:35:03] Warning: Only 15 articles found (expected 20+)</div>
                <div class="log-line log-success">[12:35:15] Analysis completed for 6 articles</div>
            </div>
        </div>

        <div id="analytics-panel" class="panel">
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>Today's Stats</h3>
                    <div class="setting-item">
                        <label>Articles Fetched:</label>
                        <span id="stat-fetched">--</span>
                    </div>
                    <div class="setting-item">
                        <label>Articles Analyzed:</label>
                        <span id="stat-analyzed">--</span>
                    </div>
                    <div class="setting-item">
                        <label>Success Rate:</label>
                        <span id="stat-success">--</span>
                    </div>
                    <div class="setting-item">
                        <label>Avg Analysis Time:</label>
                        <span id="stat-time">--</span>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>Content Quality</h3>
                    <div class="setting-item">
                        <label>Avg Word Count:</label>
                        <span id="stat-words">--</span>
                    </div>
                    <div class="setting-item">
                        <label>Fallback Usage:</label>
                        <span id="stat-fallback">--</span>
                    </div>
                    <div class="setting-item">
                        <label>Top Source:</label>
                        <span id="stat-source">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for editing analysis -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Analysis</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div>
                <textarea id="analysis-editor" placeholder="Edit the analysis content..."></textarea>
                <div style="margin-top: 12px;">
                    <button class="btn" onclick="saveAnalysis()">üíæ Save</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/admin-core.js"></script>
    <script src="js/admin-ui.js"></script>
    <script src="js/admin-prompts.js"></script>
    <script src="js/admin-bulk.js"></script>
    <script src="js/admin-init.js"></script>
</body>
</html>
